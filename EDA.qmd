---
title: "EDA"
format: html
editor: visual
---

## Introduction

Diabetes is a chronic disease affecting more than [10% of adults worldwide](https://ncdalliance.org/explore-ncds/ncds/diabetes?gad_source=1&gad_campaignid=17280909267&gbraid=0AAAAAoah2CWm1l8zrTC4K7w5H-ix2lvGe&gclid=Cj0KCQiAubrJBhCbARIsAHIdxD_rD15vBLNvnICmcPUJjveVxXD0WRGPyxEgODxFc3z4YYAT00jRoFUaAleZEALw_wcB).It is characterized by the body’s inability to produce or properly use insulin, a hormone that regulates blood sugar. Diabetes is a lifelong condition that often leaves a person reliant on external insulin sources or other glucose-lowering treatments, and it can predispose individuals to worse health outcomes. As with most chronic diseases, early diagnosis and prevention are vital to reducing health risks.

The [dataset](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset/data) used here is a cleaned version of the CDC’s Behavioral Risk Factor Surveillance System (BRFSS) survey. As the name suggests, it collects information on health-related risk factors, such as age, prior health conditions, BMI, and behaviors like smoking and drinking, along with whether a respondent has diabetes or prediabetes. We can use this information to explore correlations between these factors and diabetes status and to build predictive models for identifying people at increased risk.

*Note: There are multiple types of diabetes, but the BRFSS data does not distinguish among them. The only form of diabetes that is preventable through behavioral or lifestyle changes is Type II diabetes. Prediabetes is also specifically associated with Type II diabetes. Therefore, this dataset is most relevant to studying Type II diabetes, which accounts for roughly 90% of all diabetes cases. Depending on what we observe in the EDA, we may choose to remove outliers who likely have another form of diabetes, since those cases would not be influenced by the behavioral risk factors included in this dataset.*

## Loading Data

Libraries
```{r message=FALSE}
library(tidyverse)
library(janitor)
```

Importing Data from Local Drive
```{r}
df <- read_csv("data/diabetes_binary_health_indicators_BRFSS2015.csv")
```
Checking missingness from dataset. There should not be any missing values according to the creator of this cleaned data.
```{r}
colSums(is.na(df))
```

Changing all categorical variables to factors. 
*Slightly Salty note: Why is the Variable of "Age When Told Diabetic" excluded?*
```{r}
df <- df |>
  mutate(across(-c(BMI, GenHlth, MentHlth, PhysHlth, Sex, Age, Education, Income),
                ~factor(.x, levels = c(0, 1), labels = c("No", "Yes")))) |>
  mutate(GenHlth = ordered(GenHlth, levels = c(1, 2, 3, 4, 5), label=c("excellent", "very good", "good", "fair", "poor"))) |>
  mutate(Sex = factor(Sex, levels = c(0, 1), labels = c("female", "male"))) |>
  mutate(Age = ordered(Age,
         levels = 1:13, 
         labels = c("18-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80 or older"))) |>
  mutate(Education = ordered(Education, levels = 1:6,
         labels = c("Never attended school or only kindergarten", "Elementary", "Some high school", "High school graduate", "Some college", "College graduate"))) |>
  mutate(Income = ordered(Income, levels = 1:8, 
         labels = c("<$10,000", "$10,000-$15,000", "$15,000-$20,000", "$20,000-$25,000", "$25,000-$35,000", "$35,000-$50,000", "$50,000-$75,000", ">$75,000")))

```

## Data Exploration

### Single Variable

One-way tables for categorical data. There are quite a few variables where a value has less than 5% of the data, but tree models are good at handling this, so we will not exclude these columns.
```{r}
lapply(names(df |> select(-c(BMI, PhysHlth, MentHlth))), function(x) tabyl(df, x))
```

Looking at the data, the frequencies within education and income are too unbalanced. I am going to combine the lower categories to account for this
```{r}
df <- df |>
  mutate(
    Education = fct_collapse(Education,
      "Up to some high school" = c("Never attended school or only kindergarten", "Elementary", "Some high school")),
    Income = fct_collapse(Income, "<$20,000" = c("<$10,000", "$10,000-$15,000", "$15,000-$20,000")))
```


```{r}
tabyl(df, Education)
tabyl(df, Income)
```


Viewing the distribution of numerical data. 
```{r}
par(mfrow=c(1, 3))
hist(df$BMI)
hist(df$PhysHlth)
hist(df$MentHlth)
par(mfrow=c(1,1))
```
Numeric Data summaries
```{r}
summary(df |> select(BMI, MentHlth, PhysHlth))
```

### Multi Variable
#### By the Response Variable

```{r}

plot_list <- vector(mode = "list", length = length(df))

for(i in 1:length(df)){
  if(!is.numeric(df[[i]])){
    p <- ggplot(data=df, aes(x=!!sym(names(df)[i]), fill = Diabetes_binary)) +
      geom_bar() +
      labs(title = names(df)[i], x = NULL, y = NULL) +
      theme(legend.position = "none")
  }else{
    p <- ggplot(data=df, aes(x=!!sym(names(df)[i]), fill = Diabetes_binary)) +
      geom_density(alpha=.5) +
      labs(title = names(df)[i], x = NULL, y = NULL) +
      theme(legend.position = "none")
  }
  plot_list[[i]] <- p
}

gridExtra::grid.arrange(grobs = plot_list, nrows=6)
```

```{r}
cross_tabs <- lapply(names(df |> select(-c(BMI, PhysHlth, MentHlth, Diabetes_binary))), function(x) xtabs(~ df[[x]] + df$Diabetes_binary))

names(cross_tabs) <- names(df|> select(-c(BMI, PhysHlth, MentHlth, Diabetes_binary)))
cross_tabs
```


```{r}
df |> select(c(Diabetes_binary, BMI, PhysHlth, MentHlth)) |>
  group_by(Diabetes_binary) |>
  summarise(
    across(
      .cols = c(BMI, PhysHlth, MentHlth), 
      .fns = list(
        min  = min,
        q1   = ~quantile(., 0.25),      
        med  = median,                  
        mean = mean,
        q3   = ~quantile(., 0.75),     
        max  = max))) |>
  pivot_longer(
    cols = -Diabetes_binary,
    names_to = "Metric",
    values_to = "Value"
  ) |>

  separate_wider_delim(
    cols = Metric,
    delim = "_",
    names = c("Feature", "Statistic")
  ) |>
  
  pivot_wider(
    id_cols = c(Diabetes_binary, Statistic), 
    names_from = Feature, 
    values_from = Value,
    names_glue = "{.value}_{.name}" 
  )
```

```{r}
df |> select(c(Diabetes_binary, PhysHlth)) |>
  filter(PhysHlth > 0) |>
  group_by(Diabetes_binary) |>
  summarise(
    across(
      .cols = PhysHlth, 
      .fns = list(
        med  = median,                  
        mean = mean)))

df |> select(c(Diabetes_binary, MentHlth)) |>
  filter(MentHlth > 0) |>
  group_by(Diabetes_binary) |>
  summarise(
    across(
      .cols = MentHlth, 
      .fns = list(
        med  = median,                  
        mean = mean)))
```










[Click here for the Modeling Page](Modeling.html)